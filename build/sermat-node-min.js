module.exports=function __init__(){"use strict";function member(a,b,c,d){d=0|d,Object.defineProperty(a,b,{value:c,writable:4&d,configurable:2&d,enumerable:1&d})}function _modifier(a,b,c){return a&&a.hasOwnProperty(b)?a[b]:c}function identifier(a,b){var c=a.__SERMAT__&&a.__SERMAT__.identifier||a.name||(FUNCTION_ID_RE.exec(a+"")||[])[1];if(!c&&b)throw new Error("Sermat.identifier: Could not found id for type "+a+"!");return c}function record(a){var b="function"==typeof a?identifier(a,!0):a+"";return this.registry[b]}function register(a,b){if("function"!=typeof b.type)throw new Error("Sermat.register: No constructor found for type ("+b+")!");b={type:b.type,identifier:(b.identifier||identifier(b.type,!0)).trim(),serializer:b.serializer,materializer:b.materializer||materializeWithConstructor.bind(this,b.type),global:!!b.global,include:b.include};var c=b.identifier;if(["true","false","null","NaN","Infinity",""].forEach(function(a){if(c===a)throw new Error("Sermat.register: Invalid identifier '"+c+"'!")}),a.hasOwnProperty(c))throw new Error("Sermat.register: Construction '"+c+"' is already registered!");if("function"!=typeof b.serializer)throw new Error("Sermat.register: Serializer for '"+c+"' is not a function!");if("function"!=typeof b.materializer)throw new Error("Sermat.register: Materializer for '"+c+"' is not a function!");return Object.freeze(b),a[c]=b,b.global&&!CONSTRUCTIONS[c]&&(CONSTRUCTIONS[c]=b),b.include&&this.include(b.include),b}function remove(a,b){if(!a.hasOwnProperty(b))throw new Error("Sermat.remove: A construction for '"+b+"' has not been registered!");var c=a[b];return delete a[b],c}function include(a){var b=null;switch(typeof a){case"function":return b=this.record(a),!b&&a.__SERMAT__&&(b=Object.assign({},a.__SERMAT__),a.hasOwnProperty("__SERMAT__")||(b.identifier=this.identifier(a,!0)),b.type=a,b=this.register(b)),b;case"string":return b=this.record(a),!b&&CONSTRUCTIONS[a]&&(b=this.register(CONSTRUCTIONS[a])),b;case"object":if(Array.isArray(a))return a.map(function(a){return this.include(a)}.bind(this));if("function"==typeof a.type)return this.record(a.identifier||a.type)||this.register(a);if(a&&a.__SERMAT__&&a.__SERMAT__.include)return this.include(a.__SERMAT__.include);default:throw new Error("Sermat.include: Could not include ("+a+")!")}}function exclude(a){switch(typeof a){case"string":return this.record(a)?(this.remove(a),1):0;case"function":return this.exclude(identifier(a));case"object":if(Array.isArray(a)){var b=0;return a.forEach(function(a){b+=this.exclude(a)}.bind(this)),b}default:throw new Error("Sermat.exclude: Could not exclude ("+a+")!")}}function serialize(a,b){function c(a,b){switch(typeof a){case"undefined":return d();case"boolean":case"number":return a+"";case"string":return e(a);case"function":case"object":return f(a,b)}}function d(){switch(typeof j){case"undefined":return"undefined";case"function":if(j.prototype instanceof Error)throw new j("Sermat.ser: Cannot serialize undefined value!");var a=j.call(null);return"undefined"==typeof a?"undefined":c(a);default:return c(j)}}function e(a){return JSON.stringify(a)}function f(a,b){if(!a)return"null";if(o.indexOf(a)>=0&&h!==CIRCULAR_MODE)throw new TypeError("Sermat.ser: Circular reference detected!");var d,j,q="";if(n){if(d=n.indexOf(a),d>=0){if(h&BINDING_MODE)return"$"+d;throw new TypeError("Sermat.ser: Repeated reference detected!")}d=n.push(a)-1,h&BINDING_MODE&&(q="$"+d+(i?" = ":"="))}o.push(a);var r=b&&b+"	";if(Array.isArray(a))q+=g(a,b,r);else{var s=_getProto(a);if(a.constructor===Object||!l||m&&!s.hasOwnProperty("constructor"))d=0,q+="{"+r,Object.keys(a).forEach(function(b){q+=(d++?","+r:"")+(ID_REGEXP.exec(b)?b:e(b))+(i?" : ":":")+c(a[b],r)}),m&&!s.hasOwnProperty("constructor")&&(q+=(d++?","+r:"")+r+"__proto__:"+f(s,b)),q+=b+"}";else{var t=p.record(a.constructor)||k&&p.include(a.constructor);if(!t)throw new TypeError('Sermat.ser: Unknown type "'+p.identifier(a.constructor)+'"!');var u=t.serializer.call(p,a),v=t.identifier;if(j=u.length,q+=(ID_REGEXP.exec(v)?v:e(v))+"("+r,j>0)for(q+=c(u[0],r),d=1;j>d;d++)q+=","+r+c(u[d],r);q+=b+")"}}return o.pop(),q}function g(a,b,d){var e="["+d;if(a.length>0){e+=c(a[0],d);for(var g=1,h=a.length;h>g;g++)e+=","+d+c(a[g],d)}e+=b+"]";var i=Object.keys(a).filter(isNaN);if(i.length>0){var j={};i.forEach(function(b){j[b]=a[b]}),e="Array("+e+","+f(j,d)+")"}return e}var h=_modifier(b,"mode",this.modifiers.mode),i=_modifier(b,"pretty",this.modifiers.pretty),j=_modifier(b,"onUndefined",this.modifiers.onUndefined),k=_modifier(b,"autoInclude",this.modifiers.autoInclude),l=_modifier(b,"useConstructions",this.modifiers.useConstructions),m=_modifier(b,"climbPrototypes",this.modifiers.climbPrototypes),n=h===REPEAT_MODE?null:[],o=[],p=this;return c(a,i?"\n":"")}function serializeAsType(a){return new type(a)}function construct(a,b,c){var d=this.record(a);if(d)return d.materializer.call(this,b,c);throw new SyntaxError("Sermat.construct: Cannot materialize type '"+a+"'")}function materialize(source,modifiers){function nextToken(){var a,b,c=LEXER.exec(input);if(text="",c){for(a=c[0].length,input=input.substr(a),offset+=a,b=1,a=TOKENS.length;a>=b;b++)if(c[b]){token=TOKENS.charAt(b-1),text=c[b];break}return text||(token=c[b]||"$"),token}error('Invalid character "'+input.charAt(0)+'"')}function error(a){a=a||"Parse error",offset-=text.length;var b=0,c=0;throw source.substr(0,offset).replace(RE_EOL,function(a,d){return c=d+a.length,b++,""}),new SyntaxError("Sermat.mat: "+a+" at line "+(b+1)+" column "+(offset-c+1)+" (offset "+(offset+1)+")!")}function shift(a){token!==a&&error(),nextToken()}function parseValue(){var t=text;switch(token){case"n":case"s":return nextToken(),eval(t);case"[":return nextToken(),parseArray([]);case"{":return nextToken(),parseObject({});case"b":return parseBind();case"i":return nextToken(),CONSTANTS.hasOwnProperty(t)?CONSTANTS[t]:(shift("("),parseConstruction(t,null));default:error()}}function parseArray(a){if("]"!==token){for(a.push(parseValue());","===token;)nextToken(),a.push(parseValue());shift("]")}else nextToken();return a}function parseObject(a){if("}"!==token){for(parseMember(a);","===token;)nextToken(),parseMember(a);shift("}")}else nextToken();return a}function parseKey(){var t=text;switch(token){case"i":return nextToken(),t;case"s":return nextToken(),eval(t);default:error()}}function parseMember(a){var b=parseKey();return shift(":"),"__proto__"===b?_setProto(a,parseValue()):a[b]=parseValue(),a}function parseBind(){var a=text;if(nextToken(),"="!==token)return bindings[a];switch(bindings.hasOwnProperty(a)&&error("Binding "+a+" cannot be reassigned"),nextToken(),token){case"[":return nextToken(),parseArray(bindings[a]=[]);case"{":return nextToken(),parseObject(bindings[a]={});case"i":var b=text;return nextToken(),shift("("),parseConstruction(b,bindings[a]=sermat.construct(b,null,null));default:return bindings[a]=parseValue()}}function parseConstruction(a,b){var c=[];if(")"!==token){for(c.push(parseValue());","===token;)nextToken(),c.push(parseValue());shift(")")}else nextToken();return sermat.construct(a,b,c)}var input=source+"",offset=0,token,text,bindings=modifiers&&modifiers.bindings||{},sermat=this;nextToken();var result=parseValue();return shift("$"),result}function serializeAsProperties(a,b,c){var d,e={},f=Array.isArray(b);for(var g in b)d=b[g],c&&!a.hasOwnProperty(d)||(e[f?d:g]=a[d]);return[e]}function materializeWithConstructor(a,b,c){return b||(b=Object.create(a.prototype),c)?(a.apply(b,c),b):b}function sermat(a,b){return this.mat(this.ser(a,b))}function signature(){for(var a,b,c="",d=0;d<arguments.length;d++)b=arguments[d],a=typeof b,d&&(c+=","),c+="object"===a?b?identifier(b.constructor):"":a;return c}function checkSignature(a,b,c,d){var e=signature.apply(this,[c].concat(d));if(!b.exec(e))throw new TypeError("Sermat.checkSignature: Wrong arguments for construction of "+a+" ("+e+")!");return!0}function serialize_Error(a){return[a.message,a.name||"",a.stack||""]}function materializer_Error(a){return function(b,c){var d=null;return c&&(d=new a(c[0]+""),d.name=c[1]+"",d.stack=c[2]+""),d}}function type(a){this.typeConstructor=a}function Sermat(a){var b={},c={};member(this,"registry",b),member(this,"register",register.bind(this,b)),member(this,"remove",remove.bind(this,b)),a=a||{},member(this,"modifiers",c),member(c,"mode",_modifier(a,"mode",BASIC_MODE),5),member(c,"onUndefined",_modifier(a,"onUndefined",TypeError),5),member(c,"autoInclude",_modifier(a,"autoInclude",!0),5),member(c,"useConstructions",_modifier(a,"useConstructions",!0),5),member(c,"climbPrototypes",_modifier(a,"climbPrototypes",!0),5),this.include("Boolean Number String Object Array Date RegExp type".split(" "))}var _getProto=Object.getPrototypeOf||function(a){return a.__proto__},_setProto=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_assign=Object.assign||function(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),r},FUNCTION_ID_RE=/^\s*function\s+([\w\$]+)/,ID_REGEXP=/^[a-zA-Z_][a-zA-Z0-9_]*(?:[\.-][a-zA-Z0-9_]+)*$/,BASIC_MODE=0,REPEAT_MODE=1,BINDING_MODE=2,CIRCULAR_MODE=3,RE_IGNORABLES=/(?:\s|\/\*(?:[\0-\)+-.0-\uFFFF]*|\*+[\0-\)+-.0-\uFFFF])*\*+\/)*/,RE_NUM=/[+-]?(?:Infinity|\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)/,RE_STR=/\"(?:[^\\\"]|\\[^\n])*\"|``/,RE_ID=/[a-zA-Z_](?:[.-]?[a-zA-Z0-9_]+)*/,RE_BIND=/\$[a-zA-Z0-9_]+(?:[.-]?[a-zA-Z0-9_]+)*/,RE_SYMBOLS=/[\,[\]{:}(=)]/,RE_EOL=/\r\n?|\n/g,LEXER=new RegExp("^"+RE_IGNORABLES.source+"(?:("+RE_NUM.source+")|("+RE_STR.source+")|("+RE_ID.source+")|("+RE_BIND.source+")|("+RE_SYMBOLS.source+")|$)"),TOKENS="nsib",CONSTANTS={undefined:void 0,"true":!0,"false":!1,"null":null,NaN:NaN,Infinity:1/0},CONSTRUCTIONS={};[[Boolean,function(a){var b=!!a.valueOf();return Object.keys(a).length>0?[b,_assign({},a)]:[b]},function(a,b){return b&&_assign(new Boolean(b[0]),b[1])}],[Number,function(a){var b=+a.valueOf();return Object.keys(a).length>0?[b,_assign({},a)]:[b]},function(a,b){return b&&_assign(new Number(b[0]),b[1])}],[String,function(a){var b=""+a.valueOf();return Object.keys(a).length>a.length?[b,_assign({},a)]:[b]},function(a,b){return b&&_assign(new String(b[0]),b[1])}],[Object,function(a){return[a]},function(a,b){return b&&Object.apply(null,b)}],[Array,function(a){return Object.keys(a).length>0?[a,_assign({},a)]:[a]},function(a,b){return b&&_assign(new Array(b[0]),b[1])}],[RegExp,function(a){var b=/^\/(.+?)\/([a-z]*)$/.exec(a+"");return b||raise("serialize_RegExp","Cannot serialize RegExp "+a+"!",{value:a}),Object.keys(a).length>0?[b[1],b[2],_assign({},a)]:[b[1],b[2]]},function(a,b){return b&&checkSignature("RegExp",/^(,string){1,2}(,Object)?$/,a,b)&&_assign(new RegExp(b[0],"string"==typeof b[1]?b[1]:""),"object"==typeof b[1]?b[1]:b[2])}],[Date,function(a){var b=[a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()];return Object.keys(a).length>0&&b.push(_assign({},a)),b},function(a,b){if(b&&checkSignature("Date",/^(,number){1,7}(,Object)?$/,a,b)){var c="object"==typeof b[b.length-1]?b.pop():null;return _assign(new Date(Date.UTC(0|b[0],+b[1]||1,0|b[2],0|b[3],0|b[4],0|b[5],0|b[6])),c)}return null}],[Function,function(a){var b=/^function\s*[\w$]*\s*\(((?:\s*[$\w]+\s*,?)*)\)\s*\{([\0-\uFFFF]*)\}$/.exec(a+"");if(!b)throw new TypeError("Could not serialize Function ("+a+")!");return Object.keys(a).length>0?[b[1],b[2],_assign({},a)]:[b[1],b[2]]},function(a,b){return b&&checkSignature("Function",/^(,string){2}(,Object)?$/,a,b)&&_assign(new Function(b[0],b[1]),b[2])}],[Error,serialize_Error,materializer_Error(Error)],[EvalError,serialize_Error,materializer_Error(EvalError)],[RangeError,serialize_Error,materializer_Error(RangeError)],[ReferenceError,serialize_Error,materializer_Error(ReferenceError)],[SyntaxError,serialize_Error,materializer_Error(SyntaxError)],[TypeError,serialize_Error,materializer_Error(TypeError)],[URIError,serialize_Error,materializer_Error(URIError)]].forEach(function(a){var b=identifier(a[0],!0);member(CONSTRUCTIONS,b,Object.freeze({identifier:b,type:a[0],serializer:a[1],materializer:a[2]}),1)}),member(CONSTRUCTIONS,"type",type.__SERMAT__=Object.freeze({identifier:"type",type:type,serializer:function(a){var b=this.record(a.typeConstructor);if(b)return[b.identifier];throw new TypeError('Unknown type "'+identifier(a.typeConstructor)+'"!')},materializer:function(a,b){if(!b)return null;if(checkSignature("type",/^,string$/,a,b)){var c=this.record(b[0]);if(c)return c.type}throw new TypeError("Cannot materialize construction for type("+b+")!")}}),1);var __members__={BASIC_MODE:BASIC_MODE,REPEAT_MODE:REPEAT_MODE,BINDING_MODE:BINDING_MODE,CIRCULAR_MODE:CIRCULAR_MODE,CONSTRUCTIONS:CONSTRUCTIONS,identifier:identifier,record:record,include:include,exclude:exclude,serialize:serialize,ser:serialize,serializeAsProperties:serializeAsProperties,serializeAsType:serializeAsType,signature:signature,checkSignature:checkSignature,materialize:materialize,mat:materialize,construct:construct,materializeWithConstructor:materializeWithConstructor,sermat:sermat};Object.keys(__members__).forEach(function(a){var b=__members__[a];member(Sermat.prototype,a,b)});var __SINGLETON__=new Sermat;return __SINGLETON__.include(["Date","RegExp"]),Object.keys(__members__).forEach(function(a){var b=__members__[a];member(Sermat,a,"function"==typeof b?b.bind(__SINGLETON__):b)}),["registry","register","remove","modifiers"].forEach(function(a){member(Sermat,a,__SINGLETON__[a])}),member(Sermat,"__package__","sermat"),member(Sermat,"__name__","Sermat"),member(Sermat,"__init__",__init__,4),member(Sermat,"__dependencies__",[],4),Sermat}();
//# sourceMappingURL=sermat-node-min.js.map